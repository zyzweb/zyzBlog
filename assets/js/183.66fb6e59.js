(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{629:function(e,t,r){"use strict";r.r(t);var s=r(2),o=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("解决跨域的 2 个插件(都不好用)")]),e._v(" "),t("p",[e._v("requestly "),t("a",{attrs:{href:"https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf/related?hl=en-US",target:"_blank",rel:"noopener noreferrer"}},[e._v("access-control-allow-origin"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"解决跨域的几种方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域的几种方法"}},[e._v("#")]),e._v(" 解决跨域的几种方法")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("document.domain + iframe 跨域")])]),e._v(" "),t("li",[t("p",[e._v("location.hash + iframe")])]),e._v(" "),t("li",[t("p",[e._v("window.name + iframe 跨域")])]),e._v(" "),t("li",[t("p",[e._v("postMessage 跨域")])]),e._v(" "),t("li",[t("p",[e._v("跨域资源共享（ CORS ）")])]),e._v(" "),t("li",[t("p",[e._v("nginx 代理跨域")])]),e._v(" "),t("li",[t("p",[e._v("nodejs 中间件代理跨域")])]),e._v(" "),t("li",[t("p",[e._v("WebSocket 协议跨域")])]),e._v(" "),t("li",[t("p",[e._v("vue 中设置 proxy")])])]),e._v(" "),t("h3",{attrs:{id:"简单请求-针对-cors-而言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单请求-针对-cors-而言"}},[e._v("#")]),e._v(" 简单请求(针对 cors 而言)")]),e._v(" "),t("p",[e._v("必须同时满足下面条件")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("请求方法是 HEAD GET POST")])]),e._v(" "),t("li",[t("p",[e._v("请求头类型只能是 Accept Accept-Language Content-Language Content-Type")])]),e._v(" "),t("li",[t("p",[e._v("Content-Type 如果有只能是三个值"),t("code",[e._v("application/x-www-form-urlencoded")]),e._v("、"),t("code",[e._v("multipart/form-data")]),e._v("、"),t("code",[e._v("text/plain")])])]),e._v(" "),t("li",[t("p",[e._v("请求中的任意 XMLHttpRequestUpload 对象均没有注册任何事件监听器")])]),e._v(" "),t("li",[t("p",[e._v("请求中没有使用 ReadableStream 对象")])])]),e._v(" "),t("h3",{attrs:{id:"复杂请求会发-options-和服务器确认-若没有通过浏览器会阻止请求的发送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复杂请求会发-options-和服务器确认-若没有通过浏览器会阻止请求的发送"}},[e._v("#")]),e._v(" 复杂请求会发 options 和服务器确认,若没有通过浏览器会阻止请求的发送")]),e._v(" "),t("p",[e._v("主页面 http://www.foo.com/js/a.js iframe 页面 http://foo.com/js/b.js")]),e._v(" "),t("p",[e._v("主页面设置 document.domain='foo.com'可以访问子页面的内容")]),e._v(" "),t("h3",{attrs:{id:"cors-头信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cors-头信息"}},[e._v("#")]),e._v(" cors 头信息")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 预检请求头信息")]),e._v("\nAccess-Control-Request-Headers: X-Custom-Header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("自定义"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#指定浏览器CORS请求会额外发送的头信息字段")]),e._v("\nAccess-Control-Request-Method: POST   "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#用来列出浏览器的CORS请求会用到哪些HTTP方法")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 预检响应头信息")]),e._v("\nAccess-Control-Allow-Headers: X-PINGOTHER, Content-Type "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#如果包含Access-Control-Request-Headers字段，则Access-Control-Allow-Headers字段是必需")]),e._v("\nAccess-Control-Allow-Methods: POST, GET, OPTIONS  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#服务器支持的所有跨域请求的方法")]),e._v("\n\nAccess-Control-Allow-Origin: https://cdnsit.jyblife.com   "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#请求跨域 要发送cookie不能设为*")]),e._v("\nAccess-Control-Allow-Credentials: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 否允许发送Cookie  authorization  TLS client certificates")]),e._v("\nAccess-Control-Max-Age: "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("86400")]),e._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#本次预检请求的有效期，单位为秒(会缓存)")]),e._v("\nAccess-control-expose-headers:111  "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# XMLHttpRequest.getResponseHeader("Content-Type")的其他  哪些响应头字段可以暴露给外部')]),e._v("\nOrigin ： 指示获取资源的请求是从什么域发起的"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("跨域时浏览器自动加上的"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("h3",{attrs:{id:"引荐来源网址政策"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引荐来源网址政策"}},[e._v("#")]),e._v(" 引荐来源网址政策")]),e._v(" "),t("p",[t("strong",[e._v("strict-origin-when-cross-origin")]),e._v(" 跨域是 refer 只会展示 origin 不会展示完整地址")]),e._v(" "),t("p",[t("strong",[e._v("no-referrer-when-downgrade")]),e._v(" https 协议降为 http 协议时不发送 referrer 给跳转网站的服务器")]),e._v(" "),t("p",[t("strong",[e._v("unsafe-url")])]),e._v(" "),t("p",[e._v("Chrome 计划在 85 版开始 将其切换默认策略 no-referrer-when-downgrade 更换到 strict-origin-when-cross-origin")]),e._v(" "),t("p",[e._v("从 "),t("code",[e._v("https://site-one.example/stuff/detail?tag=red")]),e._v(" 访问 "),t("code",[e._v("https://site-two.example/…")])]),e._v(" "),t("ul",[t("li",[e._v("使用 "),t("code",[e._v("no-referrer-when-downgrade")]),e._v(": Referer: "),t("code",[e._v("https://site-one.example/stuff/detail?tag=red")]),e._v("。")]),e._v(" "),t("li",[e._v("使用 "),t("code",[e._v("strict-origin-when-cross-origin")]),e._v(": Referer: "),t("code",[e._v("https://site-one.example/")])])]),e._v(" "),t("p",[t("strong",[e._v("不变")])]),e._v(" "),t("ul",[t("li",[e._v("和 "),t("code",[e._v("no-referrer-when-downgrade")]),e._v(" 一样， "),t("code",[e._v("strict-origin-when-cross-origin")]),e._v(" 在从 "),t("code",[e._v("HTTPS")]),e._v(" 来源访问 "),t("code",[e._v("HTTP")]),e._v(" 站点时，不会携带 "),t("code",[e._v("Referer")]),e._v(" 头。")]),e._v(" "),t("li",[e._v("在相同的来源内，"),t("code",[e._v("Referer")]),e._v(" 标头值为完整的 "),t("code",[e._v("URL")])])]),e._v(" "),t("p",[e._v("显示的是预配标头")]),e._v(" "),t("h3",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[e._v("#")]),e._v(" 问题")]),e._v(" "),t("p",[t("img",{attrs:{src:"http://image.zhuyuanzheng.top/image-20220223184642732.png",alt:"image-20220223184642732"}})]),e._v(" "),t("p",[t("img",{attrs:{src:"http://image.zhuyuanzheng.top/image-20220223184731732.png",alt:"image-20220223184731732"}})]),e._v(" "),t("p",[e._v("触发了复杂请求但是 options 请求却没有设置 Access-Control-Allow-Origin")]),e._v(" "),t("p",[e._v("设置响应头 Content-Type': 'application/x-www-form-urlencoded'")]),e._v(" "),t("p",[e._v("axios.request 要这种写法")]),e._v(" "),t("p",[e._v("headers: {\n'Content-Type': 'application/x-www-form-urlencoded'\n}")]),e._v(" "),t("p",[t("img",{attrs:{src:"http://image.zhuyuanzheng.top/image-20220225150013475.png",alt:"image-20220225150013475"}})]),e._v(" "),t("img",{staticStyle:{zoom:"30%"},attrs:{src:"http://image.zhuyuanzheng.top/image-20220225150046003.png",alt:"image-20220225150046003"}}),e._v(" "),t("p",[e._v("返回的是 json 数据,content-Type 为 text/plain 就触发了 CORB")]),e._v(" "),t("h3",{attrs:{id:"相关链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[e._v("#")]),e._v(" 相关链接")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/414533145",target:"_blank",rel:"noopener noreferrer"}},[e._v("关闭私域跨域"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/53996160",target:"_blank",rel:"noopener noreferrer"}},[e._v("简单跨域-西岭老湿"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("阮一峰-cors"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=o.exports}}]);