# 需求和项目

jsapi 1.7.0  2.0.9

"vconsole": "3.3.4"

支付分享都要保持同一个网络环境下



### 下载链接

加油宝  https://deeplink.jyblife.com/

聚能惠  https://deeplink.jjdzmall.com/



### 虚拟号码

张莉华  511524199609235222    5240113003993581(招商银行)

/172\.|192\.|127\./.test(host)  判断是否本地



/release(\(([^)]+)\))?:\s*(.*)/  git提交日志

支付需要改2个地方:

pay.js weixin.hbs



### app链接:

```shell
jys://nav/ucenter/actWallet  #活动钱包
zzc://biz/base/cleanCaches  #清除缓存
jys://biz/Ucenter/addBandCard   #绑定银行卡
jtjr://web?url=https://www.baidu.com  #app内
jiayoubao://web?url=https://www.baidu.com #app外 
jys://coupon  #我的红包

`jiayoubao://jtjr.jiayoubao/openwith`
 <meta name="apple-itunes-app" content="app-id=909606737"> #通过meta标签打开
  weixin://  #打开微信
```

mock 请求422 请求数据类型不正确



Lottie   act_carve_up_daily/components/c_result/lottie/index.js  动画

### 嘉佑生活公众号openid

&openid=ov4rE1DIepSpB1-PsxnOPoHrP2ZE

yj_openid   ov4rE1DIepSpB1-PsxnOPoHrP2ZE

`https://a.app.qq.com/o/simple.jsp?pkgname=com.jtjr99.jiayoubao`





**BOXES_CONTEXT_DATA**

如果schema数据类型写错了导致应用不能升级,就更改字段名然后改为正确的数据类型,然后删掉原来出错那部分的配置,重新配

要自己测埋点,在测试环境测

获取验证码接口  加油宝 scene:1, 聚能惠 scene: 930121

<a href="外部二次分享.md">微信二次分享md</a>  可以参考box项目act_blind_box   h5product wxpay

外部支付看   [h5_product_jys](http://git.jyblife.com/h5_web_grp/h5_product_jys/tree/release_wxpay/development/wxpay)   weixinpay   

外部支付是生成订单号之后跳转到weixnpay支付页在进行支付

查看接口域名  window.interface_env

集成环境和生产环境的userid是一样的,token是不一样的,是2套认证机制

h5和app端的userid也是一样的,token是不一样的

货权用户: 购买过拼油计划的用户

拼油计划产品列表页：jtjr://prdSelect?type=2

## 监听webview状态

```javascript
wv.ready(() => {
  wv.webviewStateChange({
    complete: (action) => {
      // 监听页面回退
      if (action.actionType == "viewAppear") {
        this.getHomePage()
        this.getRewardRecord()
        this.getTeamRecord()
      }
    },
  });
});
```

### 有支付功能的手机号

```bash
绑定招商银行卡  5240117539555566    绑定身份证 随便一个
#加油宝可支付号码
15519890007 18825122141 13017848410
#聚能惠可支付的号码
18825122133   18825122134  18825122131
```

平台运营 推广线 货权线

积木的环境配置影响的是预览,正常环境影响的是正常链接

```javascript
// 判断环境
import detect from '@jyb/lib-detect';
let env = detect();
env =  {
  ios: true,
  android: true,
  iphone: true,
  jyb: true,
  jybVersion: '6.9.1',
  qq: false,
  version: '14.3',
  weixin: false
}
//外部链路还原
const link = helper.createPageURL('index.html',{
  act_id: util.getQuery('act_id')
})
helper.navToApp(link);

//跳转页面
import * as helper from "@/assets/js/helper";
const detailLink = helper.createPageURL('detail.html', {
  act_id: 'GhEpLBs/FzQYFAR4',
  inviterId: id,
  inviterUserId: util.getQuery('userid'),
})
helper.navTo(detailLink)
```

[微信开发工具辅助开发调试文档](http://git.jyblife.com/jybfe/team/issues/43)

### 分享功能

活动里，需要做分享的地方，除调用 app 分享外，在 app 外部（微信 + qq）也需要做外部分享

### 微信外部分享

  1. 关注测试用微信公众号，集成环境才可以调用外部分享

2. 不能在分享链接加入过多的参数，这也会导致分享失败 

### 外部分享常见问题

比如从微信分享到微信，出现分享信息有标题，但没副标题和图标现象，需要测试者关注加油宝对应环境的微信公众号

### 链路还原

部分手机微信浏览器 `openInstall` 不能在 `setTimeout` 内执行

埋点

某些版本微信浏览器，埋点上报代码后接页面跳转逻辑，会导致埋点失效。需在 `setTimeout` 内执行页面跳转



weixin.hbs 更新了用yj

http://boxes.fe.jyb.com/api/v1/template/251/version   添加模板

http://boxes.fe.jyb.com/api/v1/app/814/upgrade  升级

余额页面  jtjr:// balance

### userid

60008802    13017848476

15417404    13037173687

60008646    18138263387

更改hbs需要重启



所有金额/100



### 聚能惠链路还原

```javascript
/**
 * 链路还原
 */
openApp() {
  setTimeout(() => {
    window.location.href = 'jys://deeplink/'; // 链路还原打开聚能惠app
    setTimeout(() => {
      EventBus.$emit('hideLoading');
      window.location.href = 'http://deeplink.jjdzmall.com/'; // 打开下载聚能惠app页面
    }, 2000);
  }, 1500);
},
  
 /**
 * 分享到微信
 */
 import { shareNow } from '@/assets/js/share';
  shareNow({
    title: shareTitle || '加油宝',
    content: shareContent || '',
    url,
    menuItems: ['wxmsg', 'wxtml'],
    image: iconImg || '',
  });
```



### 活动登录态

1. 在链接 [https://cdnsit.jyblife.com/act/unionlogin/pages/index.html](https://cdnsit.jyblife.com/act/unionlogin/pages/index.html?userid=60005569&token=1778cd77f291678d2303a1e020c9a1ed) 登陆，验证码在 network 中获取，登录成功后把链接中的 userid + token 放入需要登陆态的链接即可

2. 在 app 内打开链接则不需要在链接上带 userid + token， app 会自动获取用户登录态信息，拼到链接上

### 未登录页

https://cdnsit.jyblife.com/act/unionlogin/pages/index.html?redirect=http://172.16.5.140:8099/public/pages/inviteFriend.html?act_id=GAE5ZxkBH30=

https://cdnsit.jjdzmall.com/act/unionlogin/pages/index.html?redirect=https%3A%2F%2Fcdnsit.jjdzmall.com%2Fboxes%2Fapp%2F38fdcfb14e29427ba1b0c72cdaa89bb8%2Fpages%2Findex.html%3Fact_id%3DGAE5ZxkBH30%253D



聚能惠商品详情页(商详)

https://cdnsit.jjdzmall.com/product/baina/detail.html?free_prd_id=100489&channel_type=2&pos_id=tid_30156.5.3&ver=1.2.1&platform=Android&userid=100000413&token=9f691bd40da6c3cb834a2c70030e322d&status_height=25.52381&timestamp=1634093437524&oppage=index&opobject=tid_30156.5.3&jutm_sid=a1b938941f5a3f0f5c92fad3fc8aa1d5&jutm_channel=jybApp&jutm_medium=tid_30156.5.3



### 微信支付页

https://cdnsit.jyblife.com/product/unionwxpay/index.html

https://cdnsit.jyblife.com/act/unionlogin/pages/index.html?redirect=http://172.16.5.140:8099/public/pages/inviteFriend.html?act_id=GAE5ZxkBH30=

### 支付结果页

development/hoard_oil_home/views/payResult/index.vue

肖慧手机  18344033835

13554735922 测试金额

uat可以看到验证码返回

### 添加新page要修改

1. pages/detail/page.json (**title  uid name**)
2. Pages/detail/index.js (**component**)
3. Index.hbs (4个detail) 要获取微信openid添加 {{weixin }}
4. Components/c_detail/package.json
5. 最后得重启才能重新生成public下的文件

### jsapi常用方法

应用权限检测

gotoSetting

```java
import * as helper from '@/assets/js/helper';
import * as util from '@jyb/lib-util';
import { shareNow } from '@/assets/js/share';
share() {
      const { shareTitle, shareContent, iconImg } = this.$$config.shareConfig;
      const url = helper.createPageURL(`index.html`, {
        act_id: util.getQuery('act_id')
      });
      shareNow({
        title: shareTitle || '加油宝',
        content: shareContent || '',
        url,
        menuItems: ['wxmsg', 'wxtml'],
        image: iconImg || '',
      });
    },

```

跳转链接需要可配置

![img](https://gitee.com/zyzcode/gitee-pic/raw/master/image.png)

## template-boxes-vue(模板)

## 通用

###  1.配置推送

- 运营管理系统-消息任务管理  



### 2.配置用户群(运营管理系统)

查看乐高配置的用户群

- 系统管理—用户群配置 查询useid  手机号
- APP管理—运营用户群工具 查询code对应用户群名称
- 在系统管理—用户群配置里面进行配置



### 3.新注册用户配置用户群

- 删除2021专项用户群,无渠道用户群

### 3.abc.json   代理生产 集成  链接后缀带上act_id



### 4.域名

- 加油宝h5测试页面https://cdnsit.jyblife.com
- 聚能惠h5测试页面https://cdnsit.jjdzmall.com
- 加油宝H5生产页面https://cdn.jyblife.com
- 聚能惠H5生产页面https://cdn.jjdzmall.com
- 加油宝接口测试 https://swebsit.jyblife.com
- 接口生产 https://sweb.jyblife.com
- 聚能惠接口测试https://sweb-sit.jjdzmall.com
- 埋点测试 https://report.sit.jyblife.com (get请求)
- 客户端页面测试https://app.sit.jyblife.com
- 云加测试http://cdnsit.yunjiaplus.com
- 微信鉴权 https://jybsit.jyblife.com/auth/wxRedirect
- https://cdn.jyblife.com/static/js/lib/jsapi-2.0.9.js

包名: com.jtjr99.jiayoubao.debug

### schema配置

```javascript
export default `
  Object(列表页面) {
    APageShufflingPhone(A页面活动项): Array {
      shufflingPhone(滚动顺序): Array {
        phone(滚动文字) : String
      }
    },
    APageImg(A页面banner图片): Array {
      img(图片): Image[description: "建议尺寸343*129px"],
    },
    wxNumber(微信号): String,
		navBgImage(背景图): Image[description: "建议尺寸750*120px，多出顶部部分会被裁切"],
  }
```

![image-20210623174828061](https://gitee.com/zyzcode/gitee-pic/raw/master/image-20210623174828061.png)

### 埋点配置

```javascript
data-stat-ec="actShare"

h5act: {
    id: '50001',
    index: { // 活动主页
      id: '255',
      pv: { // 活动主页-页面载入
        id: '1'
      },
      actShare: { // 一键领取按钮
        id: '2'
      }
    }
  }

import bimta from 'config/report';
bimta.pageview('30000.1.1');
bimta.event('30000.1.2');
```

```javascript
import tips from '@jyb/lib-tips';
import bimta from 'config/report';
```

## 邀请专区固定资源位(全面屏)

// 下面3种情况会隐藏提现模块
// A页面提现了;A页面没有发放奖励;是B页面 
//只有A页面没有提现且发放了奖励才显示提现模块

孙凤莹 手机  13534163244

A活动号:1075291  act_id=GhEtZho/D3kbFAR4  (普通用户)

B活动 1098506  GhEtYBsvEzsYIgR4  (仅能做非货权付费邀请的用户)

C活动：1226460  GhElLBoBF34bBAR4 (专项用户可见)

白名单活动ID: 1022856  GhEtLBkBIX0YIgR4 

应用id 1696ca72c4e540c4a462fe21ffcdd6fb

分支 release_act_self_growing_show  

push id: 13520

https://cdnsit.jyblife.com/boxes/app/1696ca72c4e540c4a462fe21ffcdd6fb/pages/index.html?act_id=GhEtZho/D3kbFAR4

jtjr://web?url=https%3A%2F%2Fcdnsit.jyblife.com%2Fboxes%2Fapp%2F1696ca72c4e540c4a462fe21ffcdd6fb%2Fpages%2Findex.html%3Fact_id%3DGhEtZho%2FD3kbFAR4fullscreen%3Dtrue&fullscreen=true

生产环境

https://cdn.jyblife.com/boxes/app/1696ca72c4e540c4a462fe21ffcdd6fb/pages/index.html?act_id=GhEtZho/D3kbFAR4&fullscreen=true&mta_id=50003.179.1&ver=6.9.0&platform=Android&userid=52640372&token=862d67ca03ed427253e352b81e5d30d0&status_height=28.333334&timestamp=1623153803730&oppage=my&opobject=F1-603-950-02&jutm_sid=a20911584442cfaf30240cfc789d492b&jutm_channel=jybApp&jutm_medium=mta_50003.179.1



## 邀请专区固定资源位(全面屏)  (迁移聚能惠)

聚能惠乐高信息：

A活动id：856701   act_id=GAE5ZxoRBzQ=

B活动：856702   act_id=GAE5ZxoRBzU=

白名单活动ID：856764   act_id=GAE5ZxoRH3w=



分支 release_act_self_growing_show_jys

https://cdnsit.jjdzmall.com/boxes/app/135396a311b44c4a997818ca8a7192f5/pages/index.html?act_id=GAE5ZxoRBzQ=



jys://web?url=https%3A%2F%2Fcdnsit.jjdzmall.com%2Fboxes%2Fapp%2F135396a311b44c4a997818ca8a7192f5%2Fpages%2Findex.html%3Fact_id%3DGAE5ZxoRBzQ%3Dfullscreen%3Dtrue&fullscreen=true  





## 邀请专区固定资源位复制

1165088    act_id=GhEpZxo/B3gZBAR4

1165089    act_id=GhEpZxo/B3gZFAR4

分支 release_act_self_growing_show_copy

https://cdn.jyblife.com/boxes/app/6488960f3d554737b308df9f95756dc3/pages/index.html?act_id=GhEpZxo/B3gZBAR4

## 货权用户签到

1086057    act_id=GhEtYRoBB30YMgR4

应用id e4325a454db34e8e92b0d21b13d419a0

分支 release_act_goodRights_sign

我的红包   **jtjr://coupon?category=2**

测试包位置url    **https://cdnsit.jyblife.com/boxes/app/e4325a454db34e8e92b0d21b13d419a0/pages/index.html?act_id=GhEtYRoBB30YMgR4**

红包ID：26824

https://cdn.jyblife.com/act/unionlogin/pages/index.html?redirect=https%3A%2F%2Fcdn.jyblife.com%2Fboxes%2Fapp%2F1696ca72c4e540c4a462fe21ffcdd6fb%2Fpages%2Findex.html

任务提醒-打开：50001.249.4
任务提醒-关闭：50001.249.9



## 微信提现修改现金红包(入口)

act_id=GS8tYBkvC3k=

应用id 76e7bd2165ba4b5f8467ae5479bbc69b

https://cdnsit.jyblife.com/boxes/app/76e7bd2165ba4b5f8467ae5479bbc69b/pages/index.html?act_id=GS8tYBkvC3k=

分支release_act_withdraw  文件act_withdraw



## 7周年社区宣传

1119602    act_id=GhEpLRs/HzsbIgR4

分支 release_act_sevenYearCommunityPublicity

应用id b4724bb7c2bd4576acf25b898cc63a50

https://cdnsit.jyblife.com/boxes/app/b4724bb7c2bd4576acf25b898cc63a50/pages/index.html?act_id=GhEpLRs/HzsbIgR4



## 红包替换(红包回收站)

GhE5LxkRHzs=(原始)

1130834  act_id=GhEpLxkvITYYBAR4

应用id  d67298277d434e6da13fa52f6f935eb5

https://cdnsit.jyblife.com/boxes/app/d67298277d434e6da13fa52f6f935eb5/pages/index.html?act_id=GhE5LxkRHzs=

分支 release_act_coupon_replace



## 续购专属福利

1129290    act_id=GhEpLBs/D3kbBAR4

https://cdnsit.jyblife.com/boxes/app/5dfa335ad70c44f3839675238ba55dc1/pages/index.html?act_id=GhEpLBs/D3kbBAR4

分支 release_act_renewal_benefits



## 拼油周报(全面屏)

1132183     act_id=GhEpLxkBA3gbMgR4

13554735922

18825122130

https://cdnsit.jyblife.com/boxes/app/55572615e7ac40e88d61c32a78a4fa42/pages/index.html?act_id=GhEpLxkBA3gbMgR4

jtjr://web?url=https%3A%2F%2Fcdnsit.jyblife.com%2Fboxes%2Fapp%2F55572615e7ac40e88d61c32a78a4fa42%2Fpages%2Findex.html%3Fact_id%3DGhEpLxkBA3gbMgR4%26fullscreen%3Dtrue&fullscreen=true

分支 release_act_fightOil_weekly

19520732043  本周有数据



## 组队拉新

1129415  act_id=GhEpLBs/FzQYFAR4

分支 release_act_team_getNew

jtjr://web?url=https%3A%2F%2Fcdn.jyblife.com%2Fboxes%2Fapp%2F3487e31aab1c40c995c6f93caea9dcb1%2Fpages%2Findex.html%3Fact_id%3DGhEpZxo%2FB3gZBAR4%26fullscreen%3Dtrue&fullscreen=true

https://cdnsit.jyblife.com/boxes/app/46625e3775594242bd7680b48ce86c78/pages/index.html?act_id=GhEpLBs/FzQYFAR4

13554735922

13428216103 有组队记录



## 组队拉新(聚能惠迁移)

856599  act_id=GAE5Zxo/LXk=

分支 release_act_team_getNew_jys

https://cdnsit.jjdzmall.com/boxes/app/6d5512511ba44590bd4b6bf063aed341/pages/index.html?act_id=GAE5Zxo/LXk=



## 邀好友0元购

1185347   act_id=GhEpYRo/C3wYMgR4

https://cdnsit.jyblife.com/boxes/app/6b26b6073bcd4c2a9d3cb8112a6b0deb/pages/index.html?act_id=GhEpYRo/C3wYMgR4

分支 release_act_inviteFriend_zeroGet



##  聚能惠app“势不可挡”拉新活动

856265  act_id=GAE5ZxkBH30=

分支  release_act_unstoppable_getnew

https://cdnsit.jjdzmall.com/boxes/app/38fdcfb14e29427ba1b0c72cdaa89bb8/pages/index.html?act_id=GAE5ZxkBH30=



## 购物返现

856588   act_id=GAE5Zxo/IXg=

856691  act_id=GAE5ZxoBLTQ=   (每日领红包和首页假数据手机号)

分支  release_act_shopping_cashback

https://cdnsit.jjdzmall.com/boxes/app/d151c421f4e14933988960fadf0a8cda/pages/index.html?act_id=GAE5Zxo/IXg=

/public/pages/nineDotNine.html?act_id=GAE5Zxo/IXg=



## 金交所新品发售

1492831  act_id=GhE9YBkBITYbFAR4

分支 release_act_goldExchange_newProduct

https://cdnsit.jyblife.com/boxes/app/5955ef7270cd45f689fefc3d5f726669/pages/index.html?act_id=GhE9YBkBITYbFAR4



## 商品导购榜单(聚能惠)

加油宝：1356650
聚能惠：856611   GAE5ZxoBAzQ=

分支 release_act_shopping_guide_list





## v5后台管理系统

YNPV4-MGR-SRV

库存报表     /product/inventory  查询|filter,导出|export  权限码 productinventory

V5供应链   appId：YNPV5-SUPPLY-CHAIN

开发环境：172.16.1.154





https://cdnsit.jjdzmall.com/boxes/app/d151c421f4e14933988960fadf0a8cda/pages/nineDotNine.html?act_id=GAE5Zxo/IXg=

https://cdnsit.jjdzmall.com/boxes/app/d151c421f4e14933988960fadf0a8cda/pages/zeroBuy.html?act_id=GAE5Zxo/IXg=



1. https://project-user-resource-1256085488.cos.ap-guangzhou.myqcloud.com/60f68acd9c7ca60011786b0b/6150396ed1ba840011cc7b8f/16328099561894255875.png
2. https://images.jyblife.com/boxes/image512365937355-0C.png
3. https://images.jyblife.com/boxes/image610537255006-%EF%BF%BD9.png
4. https://images.jyblife.com/boxes/image25831804416-%EF%BF%BD%EF%BF%BD.png
5. https://images.jyblife.com/boxes/image469091961534-%EF%BF%BDP-p.png
6. https://images.jyblife.com/boxes/image748910878649-%EF%BF%BD%EF%BF%BD%27C.png
7. https://images.jyblife.com/boxes/image232033448274-9.9.png



### 常见问题:

活动配置为空   没有在乐高配置活动

活动未发布  没有在乐高发布活动

升级失败,升级版本配置数据同层级同名字段的数据类型必须一样   上个版本schema配置错误

