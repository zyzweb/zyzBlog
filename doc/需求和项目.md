# 需求和项目

货权用户: 购买过拼油计划的用户

平台运营 推广线 货权线

积木的环境配置影响的是预览,正常环境影响的是正常链接

```javascript
//外部链路还原
const link = helper.createPageURL('index.html',{
        act_id: util.getQuery('act_id')
      })
      helper.navToApp(link);
```

[微信开发工具辅助开发调试文档](http://git.jyblife.com/jybfe/team/issues/43)

### 分享功能

活动里，需要做分享的地方，除调用 app 分享外，在 app 外部（微信 + qq）也需要做外部分享





### 微信外部分享

  1. 关注测试用微信公众号，集成环境才可以调用外部分享

2. 不能在分享链接加入过多的参数，这也会导致分享失败 

### 外部分享常见问题

比如从微信分享到微信，出现分享信息有标题，但没副标题和图标现象，需要测试者关注加油宝对应环境的微信公众号

### 链路还原

部分手机微信浏览器 `openInstall` 不能在 `setTimeout` 内执行

埋点

某些版本微信浏览器，埋点上报代码后接页面跳转逻辑，会导致埋点失效。需在 `setTimeout` 内执行页面跳转



weixin.hbs 更新了用yj

http://boxes.fe.jyb.com/api/v1/template/251/version   添加模板

http://boxes.fe.jyb.com/api/v1/app/814/upgrade  升级

余额页面  jtjr:// balance

### userid

60008802    13017848476

15417404    13037173687

60008646    18138263387

更改hbs需要重启

```javascript
// 判断环境
import detect from '@jyb/lib-detect';
let env = detect();
env =  {
  ios: true,
  android: true,
  iphone: true,
  jyb: true,
  jybVersion: '6.9.1',
  qq: false,
  version: '14.3',
  weixin: false
}

//跳转页面
import * as helper from "@/assets/js/helper";
const detailLink = helper.createPageURL('detail.html', {
  act_id: 'GhEpLBs/FzQYFAR4',
  inviterId: id,
  inviterUserId: util.getQuery('userid'),
})
helper.navTo(detailLink)
```

所有金额/100



### 聚能惠链路还原

```javascript
/**
 * 链路还原
 */
openApp() {
  setTimeout(() => {
    window.location.href = 'jys://deeplink/'; // 链路还原打开聚能惠app
    setTimeout(() => {
      EventBus.$emit('hideLoading');
      window.location.href = 'http://deeplink.jjdzmall.com/'; // 打开下载聚能惠app页面
    }, 2000);
  }, 1500);
},
  
 /**
 * 分享到微信
 */
 import { shareNow } from '@/assets/js/share';
  shareNow({
    title: shareTitle || '加油宝',
    content: shareContent || '',
    url,
    menuItems: ['wxmsg', 'wxtml'],
    image: iconImg || '',
  });
```



### 活动登录态

1. 在链接 [https://cdnsit.jyblife.com/act/unionlogin/pages/index.html](https://cdnsit.jyblife.com/act/unionlogin/pages/index.html?userid=60005569&token=1778cd77f291678d2303a1e020c9a1ed) 登陆，验证码在 network 中获取，登录成功后把链接中的 userid + token 放入需要登陆态的链接即可

2. 在 app 内打开链接则不需要在链接上带 userid + token， app 会自动获取用户登录态信息，拼到链接上

### 未登录页

https://cdnsit.jyblife.com/act/unionlogin/pages/index.html?redirect=http://172.16.5.140:8099/public/pages/inviteFriend.html?act_id=GAE5ZxkBH30=

https://cdnsit.jjdzmall.com/act/unionlogin/pages/index.html?redirect=https%3A%2F%2Fcdnsit.jjdzmall.com%2Fboxes%2Fapp%2F38fdcfb14e29427ba1b0c72cdaa89bb8%2Fpages%2Findex.html%3Fact_id%3DGAE5ZxkBH30%253D

### 微信支付页

https://cdnsit.jyblife.com/product/unionwxpay/index.html


https://cdnsit.jyblife.com/act/unionlogin/pages/index.html?redirect=http://172.16.5.140:8099/public/pages/inviteFriend.html?act_id=GAE5ZxkBH30=

肖慧手机  18344033835

13554735922 测试金额

uat可以看到验证码返回

### 添加新page要修改

1. pages/detail/page.json (**title  uid name**)
2. Pages/detail/index.js (**component**)
3. Index.hbs (4个detail) 要获取微信openid添加 {{weixin }}
4. Components/c_detail/package.json

### jsapi常用方法

应用权限检测

gotoSetting

```java
import * as helper from '@/assets/js/helper';
import * as util from '@jyb/lib-util';
import { shareNow } from '@/assets/js/share';
share() {
      const { shareTitle, shareContent, iconImg } = this.$$config.shareConfig;
      const url = helper.createPageURL(`index.html`, {
        act_id: util.getQuery('act_id')
      });
      shareNow({
        title: shareTitle || '加油宝',
        content: shareContent || '',
        url,
        menuItems: ['wxmsg', 'wxtml'],
        image: iconImg || '',
      });
    },

```

跳转链接需要可配置

![img](https://gitee.com/zyzcode/gitee-pic/raw/master/image.png)

## template-boxes-vue(模板)

## 通用

###  1.配置推送

- 运营管理系统-消息任务管理  



### 2.配置用户群(运营管理系统)

查看乐高配置的用户群

- 系统管理—用户群配置 查询useid  手机号
- APP管理—运营用户群工具 查询code对应用户群名称
- 在系统管理—用户群配置里面进行配置



### 3.新注册用户配置用户群

- 删除2021专项用户群,无渠道用户群

### 3.abc.json   代理生产 集成  链接后缀带上act_id



### 4.域名

- H5页面测试https://cdnsit.jyblife.com
- 聚能惠测试https://cdnsit.jjdzmall.com
- H5页面生产https://cdn.jyblife.com
- 接口测试 https://swebsit.jyblife.com
- 接口生产 https://sweb.jyblife.com
- 聚能惠接口测试https://sweb-sit.jjdzmall.com
- 埋点测试 https://report.sit.jyblife.com (get请求)
- 客户端页面测试https://app.sit.jyblife.com
- 云加测试http://cdnsit.yunjiaplus.com
- https://cdn.jyblife.com/static/js/lib/jsapi-2.0.9.js

包名: com.jtjr99.jiayoubao.debug

### schema配置

```javascript
export default `
  Object(列表页面) {
    APageShufflingPhone(A页面活动项): Array {
      shufflingPhone(滚动顺序): Array {
        phone(滚动文字) : String
      }
    },
    APageImg(A页面banner图片): Array {
      img(图片): Image[description: "建议尺寸343*129px"],
    },
    wxNumber(微信号): String,
		navBgImage(背景图): Image[description: "建议尺寸750*120px，多出顶部部分会被裁切"],
  }
```

![image-20210623174828061](https://gitee.com/zyzcode/gitee-pic/raw/master/image-20210623174828061.png)

### 埋点配置

```javascript
data-stat-ec="actShare"

h5act: {
    id: '50001',
    index: { // 活动主页
      id: '255',
      pv: { // 活动主页-页面载入
        id: '1'
      },
      actShare: { // 一键领取按钮
        id: '2'
      }
    }
  }

import bimta from 'config/report';
bimta.pageview('30000.1.1');
bimta.event('30000.1.2');
```

```javascript
import tips from '@jyb/lib-tips';
```

## 自生长邀请中心(全面屏)

孙凤莹 手机  13534163244

活动号:1075291  act_id=GhEtZho/D3kbFAR4

GhEtYBsvEzsYIgR4  1098506

链接c活动ID：1226460

应用id 1696ca72c4e540c4a462fe21ffcdd6fb

分支 release_act_self_growing_show

push id: 13520

http://172.16.5.140:8097/public/pages/index.html?act_id=GhEtZho/D3kbFAR4&userid=60008560&token=ba31dcf893775d3a44a7ba923ea75e45



生产环境

https://cdn.jyblife.com/boxes/app/1696ca72c4e540c4a462fe21ffcdd6fb/pages/index.html?act_id=GhEtZho/D3kbFAR4&fullscreen=true&mta_id=50003.179.1&ver=6.9.0&platform=Android&userid=52640372&token=862d67ca03ed427253e352b81e5d30d0&status_height=28.333334&timestamp=1623153803730&oppage=my&opobject=F1-603-950-02&jutm_sid=a20911584442cfaf30240cfc789d492b&jutm_channel=jybApp&jutm_medium=mta_50003.179.1



## 自身长邀请中心复制

1165088    act_id=GhEpZxo/B3gZBAR4

1165089    act_id=GhEpZxo/B3gZFAR4

分支 release_act_self_growing_show_copy

https://cdn.jyblife.com/boxes/app/6488960f3d554737b308df9f95756dc3/pages/index.html?act_id=GhEpZxo/B3gZBAR4

## 货权用户签到

1086057    act_id=GhEtYRoBB30YMgR4

应用id e4325a454db34e8e92b0d21b13d419a0

分支 release_act_goodRights_sign

我的红包   **jtjr://coupon?category=2**

测试包位置url    **https://cdnsit.jyblife.com/boxes/app/e4325a454db34e8e92b0d21b13d419a0/pages/index.html?act_id=GhEtYRoBB30YMgR4**

红包ID：26824

https://cdn.jyblife.com/act/unionlogin/pages/index.html?redirect=https%3A%2F%2Fcdn.jyblife.com%2Fboxes%2Fapp%2F1696ca72c4e540c4a462fe21ffcdd6fb%2Fpages%2Findex.html

任务提醒-打开：50001.249.4
任务提醒-关闭：50001.249.9



## 微信提现修改现金红包(入口)

act_id=GS8tYBkvC3k=

应用id 76e7bd2165ba4b5f8467ae5479bbc69b

https://cdnsit.jyblife.com/boxes/app/76e7bd2165ba4b5f8467ae5479bbc69b/pages/index.html?act_id=GS8tYBkvC3k=

分支release_act_withdraw  文件act_withdraw



## 7周年社区宣传

1119602    act_id=GhEpLRs/HzsbIgR4

分支 release_act_sevenYearCommunityPublicity

应用id b4724bb7c2bd4576acf25b898cc63a50

https://cdnsit.jyblife.com/boxes/app/b4724bb7c2bd4576acf25b898cc63a50/pages/index.html?act_id=GhEpLRs/HzsbIgR4



## 红包替换(红包回收站)

GhE5LxkRHzs=(原始)

1130834  act_id=GhEpLxkvITYYBAR4

应用id  d67298277d434e6da13fa52f6f935eb5

https://cdnsit.jyblife.com/boxes/app/d67298277d434e6da13fa52f6f935eb5/pages/index.html?act_id=GhE5LxkRHzs=

分支 release_act_coupon_replace



## 续购专属福利

1129290    act_id=GhEpLBs/D3kbBAR4

https://cdnsit.jyblife.com/boxes/app/5dfa335ad70c44f3839675238ba55dc1/pages/index.html?act_id=GhEpLBs/D3kbBAR4

分支 release_act_renewal_benefits



## 拼油周报(全面屏)

1132183     act_id=GhEpLxkBA3gbMgR4

13554735922

18825122130

https://cdnsit.jyblife.com/boxes/app/55572615e7ac40e88d61c32a78a4fa42/pages/index.html?act_id=GhEpLxkBA3gbMgR4

jtjr://web?url=https%3A%2F%2Fcdnsit.jyblife.com%2Fboxes%2Fapp%2F55572615e7ac40e88d61c32a78a4fa42%2Fpages%2Findex.html%3Fact_id%3DGhEpLxkBA3gbMgR4%26fullscreen%3Dtrue&fullscreen=true

分支 release_act_fightOil_weekly



## 组队拉新

1129415  act_id=GhEpLBs/FzQYFAR4

分支 release_act_team_getNew

jtjr://web?url=https%3A%2F%2Fcdn.jyblife.com%2Fboxes%2Fapp%2F3487e31aab1c40c995c6f93caea9dcb1%2Fpages%2Findex.html%3Fact_id%3DGhEpZxo%2FB3gZBAR4%26fullscreen%3Dtrue&fullscreen=true

https://cdnsit.jyblife.com/boxes/app/46625e3775594242bd7680b48ce86c78/pages/index.html?act_id=GhEpLBs/FzQYFAR4

13554735922



## 邀好友0元购

1185347   act_id=GhEpYRo/C3wYMgR4

https://cdnsit.jyblife.com/boxes/app/6b26b6073bcd4c2a9d3cb8112a6b0deb/pages/index.html?act_id=GhEpYRo/C3wYMgR4

分支 release_act_inviteFriend_zeroGet



##  聚能惠app“势不可挡”拉新活动

856265  act_id=GAE5ZxkBH30=

分支  release_act_unstoppable_getnew
