### 发布模板

正服需要新增1个构建：
1.web_tv
项目：boomplay-web-tv
分支：master
构建脚本：npm run build:prod
期望访问地址：https://tv.boomplay.com/

需求id：【ID1000807】
需求名称：8月tv端
测试人员: 朱原正 李小莉
是否服务端先行：是
jenkins：tes_web_tv

域名



## 域名

https://test-tv.boomplay.com/   

https://tv.boomplay.com/

测服ip  172.20.1.138 



### lottie动画

```javascript
import animationData from './lottie/tv_playing.json'
const lottieAnimation = (ele) => {
  lottie.loadAnimation({
    container: ele,
    renderer: 'svg',
    loop: true,
    autoplay: true,
    animationData
  })
}
nextTick(() => {
  lottieAnimation(proxy.$refs.ggg)
})
```





## 字体  Nunito Sans



### boomplay-tv



循环播放

随机播放   完全随机   假如10首歌 第一次随机播第一首,第二次播第三首,第三次也可能播放第一首

顺序播放

单曲循环



```json
"build": "vue-tsc --noEmit --skipLibCheck && vite build",
```

jenkins 任务名   test_web_tv

播放音频有2种方式

1. 创建audio标签   
2. 不创建audio标签 通过 js new audio()



colType  number  歌单类型

1：普通  playlists

2：歌手

3：广告

5：专辑  albums



初始播放列表3首歌曲id   colID bgc

8788094  4431388  22,15,18
10120356  5176225  5,4,4
23553114  9187003  119,105,21

测试环境可用id   54230828    54230831    54230832



colID  number  歌单id

musicID  number  歌曲id

countryGrpID  歌单组id

cols  歌单列表 Array

layout 1：Advertisement    2：Hscroll,横向滑动查看更多   3：Display 3 Items & More,只显示3个产品&点击More进入列表界面查看更多



netType  string  网络类型  WIFI  GNET(2g或3g)



https://test.boomplay.com/albums/21876797?from=home   273首歌



同一首歌http没有进行缓存(boomplay  qq音乐  网易云音乐都没有支持)

boomplay  qq音乐下载完一首歌在播放    网易云音乐分段下载   

qq音乐  网易云音乐  下载mp3状态码都是206





### 歌词



https://testsource.boomplaymusic.com/test_group10/M00/05/16/b820cc07978343748112e3ccfda8a628.lrc

企业邮箱  yuanzheng.zhu@transsnet.com



{"itemID":"8788094","itemType":"MUSIC"}

KJRBKO3wdL2GCYGrC0CCGZmcOXv4/shrZVmGhMBouPz3CbkDNTeTX6Sv1QchIZJ7



https://test.boomplaymusic.com/BoomPlayer/resource/encrypt/getResourceAddr?param=vGA7d0TZKBHnXWGDL6Kw5m8mPqJX4utGWf%2BbZiL2zRBzQODYsN8FnWFgu1WLpdTASo%2BgndUm6Ag%2BEfDSMVeoCBjHrkfrEK2VCztJdpnjkvmkD9CbvxrxvzvS8zEefo0D9ehci3RuNbuxPXfNxLfnH6KyZdF0jcxLwOLBaGjWbnRKF23eK9xTYJSEXLOIji2e8N6qoMry3%2BHJreYZo8kSjQY1y0g7IRA5uJUC5v6h%2BIrx9s7LW6kTTukpfGOl3Boe6J02GF58KOLatyAofOvO6hSzk0x6eY5a6w6eFuhdn5CK4LU3tnZZUoZNld%2FJGy33&channel=WEB







//现在

salt = "boomplayUNmn3IbI";

vector = "boomplayuvEJOzIK";



//原来

```
key: 'boomplayVr3xopAM',
iv: 'boomplay8xIsKTn9',
```



private final static String AES_ALGORITHM_NAME = "AES";
private  static final String CBC_PKCS5_PADDING = "AES/CBC/PKCS5Padding";//AES是加密方式 CBC是工作模式 PKCS5Padding是填充模式
private final static int SLAT_KEY_LENGTH = 16;
private final static int VECTOR_KEY_LENGTH = 16;







gitlab-hk

zhuyuanzheng

zz123456



tapd 

yuanzheng.zhu@transsnet.com

Aa123456



sentry

yuanzheng.zhu@transsnet.com

Aa123456



oms

yuanzheng

123456



whitelist  设置boomID白名单

OMS Accounts  添加OMS账号



### Boom ID

13037173687  142771264





1. 活动没有x-boomplay-ref请求头 webplayer有
2. getResourceAddr  x-boomplay-ref: e7ac71dfad1d610e   
3. x-boomplay-ref: Boomplay_WEBV1





QQ音乐为  audio/mp4







### 登录状态

登录



半登录(被人挤掉了)



未登录











```javascript
//sentry
try {
    const sentryTracing = document.createElement('script');
    sentryTracing.src = './sentry.tracing.6.9.17.min.js';
    document.body.appendChild(sentryTracing);
    sentryTracing.onload = function () {
      location.hostname==="www.boomplay.com" && Sentry.init({
        dsn: "https://c61a6c88bd8d486fbf11d4b19fa1b906@sentry.boomplaymusic.com/17",
        environment: "Fission_NG",
        // 版本号
        release: 'v1.0.0',
        integrations: [
          new Sentry.BrowserTracing({
            tracingOrigins: [/^https?:\/\/[^\.]+\.boomplay.com/]
          })
        ],
        logErrors: false,
        // Set tracesSampleRate to 1.0 to capture 100%
        // of transactions for performance monitoring.
        // We recommend adjusting this value in production
        tracesSampleRate: 0.1
      });
    }
  } catch (e) {
  }

//图片拼接
//https://testsource.boomplaymusic.com/test_group10/M00/07/11/4ff789997a3d4f2c9f7825b58bba09fe_464_464.jpg
export const getSourceUrl = (source: string) => {
  return /http(s)?:\/\//.test(source) ?
         source :
         `https://${isProd ? '' : 'test'}source.boomplaymusic.com/${source}`
}

// pageloading
.dialog_pageLoading .icon {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 75px;
    height: 75px;
    margin-left: -38px;
    margin-top: -38px;
    background-image: url(../../pageLoading_icon-QYJ757ET.png);
    background-repeat: no-repeat;
    background-position: 0 50%;
    background-size: auto 75px;
    -webkit-animation: stepAnimal steps(29) 1.5s infinite;
    -moz-animation: stepAnimal steps(29) 1.5s infinite;
    -o-animation: stepAnimal steps(29) 1.5s infinite;
    animation: stepAnimal steps(29) 1.5s infinite
}

@-webkit-keyframes stepAnimal {
    0% {
        background-position: 0 50%
    }
  
//选择框样式
  position: relative;
  z-index: 2;
  border: 0.06rem solid #00ae2e;
  border-radius: 0.04rem;
  padding: 0.03rem;
  position: relative;
```

### webplayer tv

播放音乐  点击播放按钮 上一首  下一首 要取消请求  

chrome 79     分辨率 1280*720





1.  按键操作，键值相关
     具体keycode 参考 KeyMap 文档即可
     内部返回监听 back 按键，浏览器遵从app 内部返回逻辑
     处于0级页面，调用 widow.close()  即可退出app ，返回到 TV OS Home

2.  app内存占用相关
     基于浏览器完整运行程序后 内存需要控制再260M以下
     内存占用越少 程序运行越流畅

3.  流媒体播放相关
     媒体格式支持，文档中有列出支持能力。

  注：
    我们目前有先用PC 版本的页面再TV上做测试。（https://www.boomplay.com/）
    目前播放流程大致是XHR 请求 音频流后 使用 window.URL.createObjectURL   获取当前文件的一个内存URL 直接交给Player 去做播放。目前这种播放流程，再电视上有些问题，最近我们正在做支持（预计 7月18日前 会支持）。
    为避免两边进度出现对不齐。建议前期TV 版本 优先选取 资源URL 直接赋值给player 播放（audio/video  可以参考deezer）或者 mediasource流程。



- 屏幕分辨率为 1280*720
- browser 版本为 chrome 79
- EPG 式H5 APP供参考
  视频EPG模式 app:  https://tv.iq.com/
  音频EPG模式 app:  http://tv.deezer.com/smarttv/622973e257290b8d68de0ddb873fcc30/foxxum/

可以参考 deezer 的Log in



<img src="https://image.zhuyuanzheng1.top/image-20220713124921787.png" alt="image-20220713124921787" style="zoom:40%;" />











电视交互

多通道重试







蒙版   高斯模糊



### 参考

[安卓Tv嵌入web开发](https://www.jianshu.com/p/32c613e06002)



```
filter: brightness(.7) blur(50px);
```



### 框架

https://github.com/nekobc1998923/vitecamp

vueuse



https://github.com/TonyaQi/Mp3Player-vue    vue 歌词



https://github.dev/KuAi9/lb-audio-v3#readme   歌词



播放量

webp



渐变



https://npm.pkg.github.com





[segmentfault  html5-audio](https://segmentfault.com/a/1190000008932943)



filter: drop-shadow(0 0 2em #42b883aa);





scrollEl = xxx

setScrollEl(xxx)

resetScrollEl(xxx)

limitingEl = xxx

requestFocus(xxx)

resetLimitingEl()

 proxy.$tv.limitingEl = XX

proxy.$tv.requestFocus(proxy.$refs.all)



node版本 和package.lock.json 有关



png可以svg不能解析









## 常见问题

### 卸载多个同名事件的其中一个(function名要一致)

document.addEventListener('keydown', listener)

document.removeEventListener('keydown', listener)



增加请求loading

取消放在请求拦截里





















首页 slider 直接往左不行要先往右在往左才能移动



http://localhost:8088/#/artists/detail?colID=1553012&afid=140361534   慢慢按可以上去按着不动上不去





下一页加loading

左移定位到侧边栏



调用$root的方法

props/emit定义使用

defineExpose  父子组件互调

figma使用

https://juejin.cn/post/7085689763696967710





1. 正常播放/暂停 是否取消请求

2. 上下切歌 是否取消请求
3. 拖到结尾是否能正常切换
4. 拖到结尾去首页能够正常切换
5. 进去播放是否正常
6. 没有歌单时候能够正常播放
7. 背景有没有正常切换





架构设计

有衬线  无衬线
